<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会議室の予約</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
</head>
<body>

    <form class="w-75 mx-auto">
        <p class="mt-3">会議室の概要</p>
        <div>
            <input class="form-control w-100 mt-1" name="name" placeholder="" required>
        </div>
        <p class="mt-3">会議開始時間</p>
        <div>
            <select id="selyearstart" class="sel_year_start" name="YYYY">
                <option value="">選択ください</option>
            </select>
            <font>年</font>
            <select id="selmonthstart" class="sel_month_start" name="MM">
                <option value="">選択ください</option>
            </select>
            <font>月</font>
            <select id="seldaystart" class="sel_day_start" name="DD">
                <option value="">選択ください</option>
            </select>
            <font>日</font>
        </div>
        <p class="mt-3">会議終了時間</p>
        <div>
            <select id="selyearend" class="sel_year_end" name="YYYY">
                <option value="">選択ください</option>
            </select>
            <font>年</font>
            <select id="selmonthend" class="sel_month_end" name="MM">
                <option value="">選択ください</option>
            </select>
            <font>月</font>
            <select id="seldayend" class="sel_day_end" name="DD">
                <option value="">選択ください</option>
            </select>
            <font>日</font>
        </div>
        <p class="mt-3">ミーティングルーム番号</p>
        <div>
            <select id="meetingroom">
                <option value ="001">第１会議室</option>
                <option value ="002">第２会議室</option>
                <option value="003">第３会議室</option>
                <option value="004">第４会議室</option>
            </select>
        </div>

        <input type="submit" class="mt-4 btn btn-primary" value="送信">
    </form>
    
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        
        $(document).ready(function () {
            const liffId = "**********-********";
            initializeLiff(liffId);
        })

        function initializeLiff(liffId) {
            liff.init({
                liffId: liffId
            }).then(() => {
                initializeApp();
            }).catch((err) => {
                console.log('LIFF Initialization failed ', err);
            });
        }

        function sendText(text) {
            liff.sendMessages([{
                'type': 'text',
                'text': text
            }]).then(function () {
                liff.closeWindow();
            }).catch(function (error) {
                window.alert('Failed to send message ' + error);
            });
        }
        
        const params = (new URL(document.location)).searchParams;
        const key = params.get('key');

        $(function () {
            $('form').submit(function () {
                const name    = $('input[name="name"]').val();
                const meetingstarty  = $("#selyearstart option:selected").val();
                const meetingstartm  = $("#selmonthstart option:selected").val();
                const meetingstartd  = $("#seldaystart option:selected").val();
                const meetingendy  = $("#selyearend option:selected").val();
                const meetingendm  = $("#selmonthend option:selected").val();
                const meetingendd  = $("#seldayend option:selected").val();
                const meetingroomnum=$("#meetingroom option:selected").val();

                const msg = `${name}\n${meetingstarty}\n${meetingstartm}\n${meetingstartd}\n${meetingendy}\n${meetingendm}\n${meetingendd}\n${meetingroomnum}`;
                sendText(msg);

                return false;
            });
        });

        $(function (){
            $.ms_DatePicker({
                YearSelector: ".sel_year_start",
                MonthSelector: ".sel_month_start",
                DaySelector: ".sel_day_start"
            });

        });

        (function($){
            $.extend({
                ms_DatePicker: function(options) {
                    var defaults = {
                        YearSelector: "#sel_year_start",
                        MonthSelector: "#sel_month_start",
                        DaySelector: "#sel_day_start",
                        FirstText: "--",
                        FirstValue: 0
                    };
                    var opts = $.extend({}, defaults, options);
                    var $YearSelector = $(opts.YearSelector);
                    var $MonthSelector = $(opts.MonthSelector);
                    var $DaySelector = $(opts.DaySelector);
                    var FirstText = opts.FirstText;
                    var FirstValue = opts.FirstValue;

                    var str = "<option value=\"" + FirstValue + "\">"+FirstText+"</option";
                    $YearSelector.html(str);
                    $MonthSelector.html(str);
                    $DaySelector.html(str);

                    // 年
                    var yearNow = new Date().getFullYear();
                    var yearSel = $YearSelector.attr("rel");
                    for (var i = yearNow+1; i >= yearNow; i--) {
                        var sed = yearSel==i?"selected":"";
                        var yearStr = "<option value=\"" + i + "\" " + sed+">"+i+"</option>";
                        $YearSelector.append(yearStr);
                    }
                    // 月
                    var monthSel = $MonthSelector.attr("rel");
                    for (var i = 1; i <= 12; i++) {
                        var sed = monthSel==i?"selected":"";
                        var monthStr = "<option value=\"" + i + "\" "+sed+">"+i+"</option>";
                        $MonthSelector.append(monthStr);
                    }
                    // 日
                    function BuildDay() {
                        if ($YearSelector.val() == 0 || $MonthSelector.val() == 0) {
                            //未選択年/月
                            $DaySelector.html(str);
                        } else {
                            $DaySelector.html(str);
                            var year = parseInt($YearSelector.val());
                            var month = parseInt($MonthSelector.val());
                            var dayCount = 0;
                            switch (month) {
                                case 1:
                                case 3:
                                case 5:
                                case 7:
                                case 8:
                                case 10:
                                case 12:
                                dayCount = 31;
                                break;
                                case 4:
                                case 6:
                                case 9:
                                case 11:
                                dayCount = 30;
                                break;
                                case 2:
                                dayCount = 28;
                                if ((year % 4 == 0) && (year % 100 != 0) || (year % 400 == 0)) {
                                    dayCount = 29;
                                }
                                break;
                                default:
                                    break;
                            }
                            var daySel = $DaySelector.attr("rel");
                            for (var i = 1; i <= dayCount; i++) {
                                var sed = daySel == i ? "selected": "";
                                var dayStr = "<option value=\"" + i + "\" "+sed+">" + i + "</option>";
                                $DaySelector.append(dayStr);
                            }
                        }
                    }
                    $MonthSelector.change(function (){
                        BuildDay();
                    });
                    $YearSelector.change(function (){
                        BuildDay();
                    });
                    if ($DaySelector.attr("rel")!="") {
                        BuildDay();
                    }
                }
                
            });

    </script>

</body>
</html>
